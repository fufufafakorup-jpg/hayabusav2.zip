const KUNCI_REMOT = "hayabusa_remote_anak_123"; 
const peer = new Peer(KUNCI_REMOT);
let videoTrack = null;
let s_stream = null;

peer.on('open', () => {
    document.getElementById('stat').innerText = "Sistem Siap!";
});

peer.on('connection', (conn) => {
    document.getElementById('stat').innerText = "Remote Terhubung!";
    conn.on('data', (data) => {
        if (data === "ON") kontrolSenter(true);
        if (data === "OFF") kontrolSenter(false);
    });
});

async function aktifkan() {
    try {
        // Ambil stream baru jika belum ada
        if (!s_stream) {
            s_stream = await navigator.mediaDevices.getUserMedia({
                video: { facingMode: "environment" }
            });
            videoTrack = s_stream.getVideoTracks()[0];
        }
        alert("Booster Aktif! Senter siap di-remote.");
    } catch (e) { 
        alert("Izin kamera ditolak/gagal!"); 
    }
}

async function kontrolSenter(status) {
    if (videoTrack) {
        try {
            // Perintah paksa untuk nyala atau mati
            await videoTrack.applyConstraints({
                advanced: [{ torch: status }]
            });
        } catch (err) {
            console.error("Gagal kontrol senter:", err);
        }
    } else {
        console.log("Kamera belum diaktifkan oleh anak!");
    }
}
